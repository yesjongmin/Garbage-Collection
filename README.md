# 가비지 컬렉션(Garbage-Collection)


* 프로그램을 개발 하다 보면 유효하지 않은 메모리인 가비지(Garbage)가 발생하게 되는데 이러한 가비지는 불필요하게 메모리를 점유하게 됩니다. 가비지 컬렉션은 메모리 관리 기법 중 하나로 프로그램이 동적으로 할당했던 메모리 영역 중에서 필요없게 된 영역을 해제하는 기능입니다.


## Minor GC와 Major GC
* Heap 영역은 처음 설계될 때 다음의 2가지를 전체로 설계되었습니다.
1. 대부분의 객체는 금방 접근 불가능한 상태가 된다.
2. 오래된 객체에서 새로운 객체로의 참조는 아주 적게 존재한다.

즉, 객체는 대부분 일회성되며, 메모리에 오랫동안 남아있는 경우는 드물다는 것입니다. 그렇기 때문에 객체의 생존 기간에 따라 물리적인 Heap 영역을 나누게 되었고 Young, Old 총 두가지 영역으로 설계되었습니다.<p>
<img width="50%" src="https://user-images.githubusercontent.com/134346376/240458393-2481cb21-264e-4c61-8388-dfc1a4636e94.png"/>

* Young 영역(Young Generation)
  * 새롭게 생성된 객체가 할당(Allocation)되는 영역
  * 대부분의 객체가 금방 Unreachable 상태가 되기 때문에, 많은 객체가 Young 영역에 생성되었다가 사라집니다.
  * Young 영역에 대한 가비지 컬렉션(Garbage Collection)을 Minor GC라고 부릅니다.
  
* Old 영역(Old Generation)
  * Young영역에서 Reachable 상태를 유지하여 살아남은 객체가 복사되는 영역
  * Young 영역보다 크게 할당되며, 영역의 크기가 큰 만큼 가비지는 적게 발생합니다.
  * Old 영역에 대한 가비지 컬렉션(Garbage Collection)을 Major GC라고 부릅니다.

#### Q. Old 영역이 더 크게 할당된 이유 ?
* Young 영역의 수명이 짧은 객체들은 큰 공간을 필요로 하지 않으며 큰 객체들은 Young 영역이 아니라 바로 Old 영역에 할당되기 때문입니다.

#### Q. Old 영역에 있는 객체가 Young 영역의 객체를 참조하는 경우 ?
 * Old 영역에는 512 bytes의 덩어리(Chunk)로 되어 있는 카드 테이블(Card Table)이 존재합니다.<p>
 <img width="50%" src="https://user-images.githubusercontent.com/134346376/240460178-38373155-d93e-4860-8110-623f5bf334a8.png"/>

* 카드 테이블에는 Old 영역에 있는 객체가 Young 영역의 객체를 참조할 때 마다 그에 대한 정보가 표시됩니다. 
* Young 영역에서 가비지 컬렉션(Minor GC)가 실행될 때 모든 Old 영역에 존재하는 객체를 검사하여 참조되지 않는 Young 영역의 객체를 식별하는 것이 비효율적이기 때문에 Young 영역에서 가비지 컬렉션이 진행될 때 카드 테이블만 조회하여 GC의 대상인지 식별할 수 있도록 하고 있습니다.
  
## 파이썬에서의 가비지 컬렉션 / 레퍼런스 카운팅(Reference counting)
  * 파이썬의 주된 가비지 콜렉션 메커니즘은 레퍼런스 카운팅(Reference counting)입니다. 파이썬에서 어떤 객체를 생성하면, C  수준 객체는 이 파이썬 객체의 타입과 레퍼런스 카운트를 가지고 있게 됩니다.
    * 레퍼런스 카운팅이란 특정 객체가 몇 번이나 참조(referenced)되고 있는지를 나타내며, 만일 특정 객체의 참조가 사라진다면 카운트는 감소하게 됩니다.
    * 이때 객체의 카운트가 0이라는 뜻은 더이상 이 객체에 접근하고 있는 코드가 없다는 의미이므로 메모리에서 삭제, 즉 할당 해제(deallocation)를 할 수 있게 되고, 바로 이 때 객체가 지워지게 됩니다. 따라서 안전하게 해당 메모리를 "즉시" 확보 가능합니다.
  
### 레퍼런스 카운트 확인
  * 아래의 내용과 함께 sys 라이브러리를 사용해서 특정 객체의 레퍼런스 카운트를 확인할 수 있습니다. 
    * 객체를 변수에 할당
    * 객체를 리스트, 튜플과 같은 자료구조에 하거나 인스턴스 프로퍼티로 추가
    * 함수에 파라미터로 전달
  
  
    >>> import sys
    >>> a = 'mystring'
    >>> sys.getrefcount(a)
    2


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
